{
  "schema_version": "1.0",
  "project": {
    "id": "project_evdd_25.2",
    "name": "EVDD Transformer (Center-tap, dual RX)",
    "category": ["magnetic-design", "EVDD", "center-tap"],
    "created_at": "2025-08-20T18:00:00+09:00",
    "app_min_version": "0.1.0"
  },

  "paths": {
    "install_dir": "<SET_BY_APP>",
    "project_dir": "${install_dir}/Projects/project_evdd_25.2",
    "envs_dir": "${install_dir}/Envs",
    "configs_dir": "${install_dir}/Configs",
    "python": {
      "conda_root": "${install_dir}/Envs/miniconda",
      "envs": {
        "base312": "${install_dir}/Envs/condaenv3.12",
        "pyaedt_regression": "${install_dir}/Envs/.v3.12_pyaedt_regression",
        "nsga2": "${install_dir}/Envs/.v3.12_nsga2"
      }
    },
    "artifacts": {
      "model_pkl": "${project_dir}/evdd_25_2_regressor.pkl",
      "preprocess_py": "${project_dir}/preprocess_evdd_25_2.py",
      "predict_py": "${project_dir}/predict_evdd_25_2.py",
      "simulate_py": "${project_dir}/simulate_evdd_25_2.py",
      "optimize_py": "${project_dir}/optimize_evdd_25_2.py"
    }
  },

  "runtime": {
    "python_version": "3.12",
    "supported_years": 1,
    "command_templates": {
      "python": "\"${paths.python.conda_root}/bin/conda\" run -p ${paths.python.envs.base312} python {script} {args}",
      "python_pyaedt": "\"${paths.python.conda_root}/bin/conda\" run -p ${paths.python.envs.pyaedt_regression} python {script} {args}",
      "python_nsga2": "\"${paths.python.conda_root}/bin/conda\" run -p ${paths.python.envs.nsga2} python {script} {args}"
    },
    "timeouts": {
      "predict_seconds": 30,
      "simulate_minutes": 60,
      "optimize_minutes": 90
    }
  },

  "data_io": {
    "input_csv": {
      "delimiter": ",",
      "header": true
    },
    "output_csv": {
      "delimiter": ",",
      "header": true
    }
  },

  "variables": {
    "inputs": [
      { "name": "w1_mm", "type": "float", "unit": "mm", "min": 0.0, "max": 100.0, "step": 0.1, "default": 20.0, "group": "geometry" },
      { "name": "l1_leg_mm", "type": "float", "unit": "mm", "min": 0.0, "max": 50.0, "step": 0.1, "default": 9.0, "group": "geometry" },
      { "name": "l1_top_mm", "type": "float", "unit": "mm", "min": 0.0, "max": 50.0, "step": 0.1, "default": 8.0, "group": "geometry" },
      { "name": "l2_mm", "type": "float", "unit": "mm", "min": 0.0, "max": 60.0, "step": 0.1, "default": 15.0, "group": "geometry" },
      { "name": "h1_mm", "type": "float", "unit": "mm", "min": 0.0, "max": 120.0, "step": 0.1, "default": 40.0, "group": "geometry" },
      { "name": "l1_center_mm", "type": "float", "unit": "mm", "min": 0.0, "max": 60.0, "step": 0.1, "default": 18.0, "group": "geometry" },

      { "name": "Tx_turns", "type": "int", "unit": "turns", "min": 1, "max": 30, "step": 1, "default": 7, "group": "geometry", "note": "단위는 권선수(무단위)" },
      { "name": "Tx_width_mm", "type": "float", "unit": "mm", "min": 0.0, "max": 20.0, "step": 0.05, "default": 2.0, "group": "geometry" },
      { "name": "Tx_height_mm", "type": "float", "unit": "mm", "min": 0.0, "max": 2.0, "step": 0.01, "default": 0.2, "group": "geometry" },
      { "name": "Tx_space_x_mm", "type": "float", "unit": "mm", "min": 0.0, "max": 10.0, "step": 0.01, "default": 0.2, "group": "geometry" },
      { "name": "Tx_space_y_mm", "type": "float", "unit": "mm", "min": 0.0, "max": 10.0, "step": 0.01, "default": 0.2, "group": "geometry" },
      { "name": "Tx_preg_mm", "type": "float", "unit": "mm", "min": 0.0, "max": 2.0, "step": 0.01, "default": 0.7, "group": "geometry" },

      { "name": "Tx_layer_space_x_mm", "type": "float", "unit": "mm", "min": 0.0, "max": 10.0, "step": 0.01, "default": 0.2, "group": "geometry" },
      { "name": "Tx_layer_space_y_mm", "type": "float", "unit": "mm", "min": 0.0, "max": 10.0, "step": 0.01, "default": 0.2, "group": "geometry" },

      { "name": "Rx_turns", "type": "int", "unit": "turns", "min": 1, "max": 15, "step": 1, "default": 1, "group": "geometry", "note": "단위는 권선수(무단위)" },
      { "name": "Rx_width_mm", "type": "float", "unit": "mm", "min": 0.0, "max": 40.0, "step": 0.1, "default": 10.0, "group": "geometry" },
      { "name": "Rx_height_mm", "type": "float", "unit": "mm", "min": 0.0, "max": 2.0, "step": 0.01, "default": 0.2, "group": "geometry" },
      { "name": "Rx_space_x_mm", "type": "float", "unit": "mm", "min": 0.0, "max": 10.0, "step": 0.01, "default": 0.3, "group": "geometry" },
      { "name": "Rx_space_y_mm", "type": "float", "unit": "mm", "min": 0.0, "max": 10.0, "step": 0.01, "default": 0.3, "group": "geometry" },
      { "name": "Rx_preg_mm", "type": "float", "unit": "mm", "min": 0.0, "max": 2.0, "step": 0.01, "default": 0.5, "group": "geometry" },

      { "name": "Rx_layer_space_x_mm", "type": "float", "unit": "mm", "min": 0.0, "max": 10.0, "step": 0.01, "default": 0.2, "group": "geometry" },
      { "name": "Rx_layer_space_y_mm", "type": "float", "unit": "mm", "min": 0.0, "max": 10.0, "step": 0.01, "default": 0.2, "group": "geometry" },

      { "name": "g1_mm", "type": "float", "unit": "mm", "min": 0.0, "max": 10.0, "step": 0.01, "default": 0.2, "group": "geometry" },
      { "name": "g2_mm", "type": "float", "unit": "mm", "min": 0.0, "max": 10.0, "step": 0.01, "default": 0.2, "group": "geometry" },



      { "name": "core_x_mm", "type": "float", "unit": "mm", "min": 1.0, "max": 100.0, "step": 0.1, "default": 20.0, "group": "geom_derived" },
      { "name": "core_y_mm", "type": "float", "unit": "mm", "min": 1.0, "max": 100.0, "step": 0.1, "default": 20.0, "group": "geom_derived" },
      { "name": "core_z_mm", "type": "float", "unit": "mm", "min": 1.0, "max": 100.0, "step": 0.1, "default": 20.0, "group": "geom_derived" },
      { "name": "core_volume_mm3", "type": "float", "unit": "mm3", "min": 10000.0, "max": 100000000.0, "step": 1000.0, "default": 2000000.0, "group": "geom_derived" },
      { "name": "core_area_mm2", "type": "float", "unit": "mm2", "min": 100.0, "max": 100000.0, "step": 10.0, "default": 5000.0, "group": "geom_derived" },
      { "name": "core_thickness_mm", "type": "float", "unit": "mm", "min": 1.0, "max": 100.0, "step": 0.1, "default": 20.0, "group": "geom_derived" },

      { "name": "total_x_mm", "type": "float", "unit": "mm", "min": 1.0, "max": 100.0, "step": 0.1, "default": 20.0, "group": "geom_derived" },
      { "name": "total_y_mm", "type": "float", "unit": "mm", "min": 1.0, "max": 100.0, "step": 0.1, "default": 20.0, "group": "geom_derived" },
      { "name": "total_z_mm", "type": "float", "unit": "mm", "min": 1.0, "max": 100.0, "step": 0.1, "default": 20.0, "group": "geom_derived" },
      { "name": "total_volume_mm3", "type": "float", "unit": "mm3", "min": 10000.0, "max": 100000000.0, "step": 1000.0, "default": 2000000.0, "group": "geom_derived" },
      { "name": "total_area_mm2", "type": "float", "unit": "mm2", "min": 100.0, "max": 100000.0, "step": 10.0, "default": 5000.0, "group": "geom_derived" },
      { "name": "total_thickness_mm", "type": "float", "unit": "mm", "min": 1.0, "max": 100.0, "step": 0.1, "default": 20.0, "group": "geom_derived" },
      


      { "name": "Operating_Current_in_A", "type": "float", "unit": "A", "min": 1, "max": 100.0, "step": 0.1, "default": 10.0, "group": "operating" },
      { "name": "Magnetizing_Current_in_A", "type": "float", "unit": "A", "min": 0.01, "max": 20.0, "step": 0.01, "default": 2.0, "group": "operating_derived" },
      { "name": "freq_kHz", "type": "float", "unit": "kHz", "min": 10.0, "max": 200.0, "step": 5.0, "default": 100.0, "group": "operating" },
      { "name": "has_pan_bool", "type": "bool", "unit": "bool", "default": false, "group": "cooling" },
      { "name": "pan_blow_mps", "type": "float", "unit": "m/s", "min": 0.0, "max": 20.0, "step": 0.1, "default": 0.0, "group": "cooling" }
    ],

    "outputs": [
      { "name": "Ltx_uH", "type": "float", "unit": "uH", "read_only": true, "min": 0.1, "max": 200.0, "group": "simulated" },
      { "name": "Lrx1_uH", "type": "float", "unit": "uH", "read_only": true, "min": 0.01, "max": 100.0, "group": "simulated" },
      { "name": "Lrx2_uH", "type": "float", "unit": "uH", "read_only": true, "min": 0.01, "max": 100.0, "group": "simulated" },

      { "name": "M1_ratio", "type": "float", "unit": "ratio", "read_only": true, "min": -10.0, "max": 10.0, "group": "simulated" },
      { "name": "M2_ratio", "type": "float", "unit": "ratio", "read_only": true, "min": -10.0, "max": 10.0, "group": "simulated" },
      { "name": "k1_ratio", "type": "float", "unit": "ratio", "read_only": true, "min": -0.999, "max": 0.999, "group": "simulated" },
      { "name": "k2_ratio", "type": "float", "unit": "ratio", "read_only": true, "min": -0.999, "max": 0.999, "group": "simulated" },

      { "name": "Lmt_uH", "type": "float", "unit": "uH", "read_only": true, "min": 0.1, "max": 200.0, "group": "simulated" },
      { "name": "Lmr1_uH", "type": "float", "unit": "uH", "read_only": true, "min": 0.01, "max": 100.0, "group": "simulated" },
      { "name": "Lmr2_uH", "type": "float", "unit": "uH", "read_only": true, "min": 0.01, "max": 100.0, "group": "simulated" },
      { "name": "Llt_uH", "type": "float", "unit": "uH", "read_only": true, "min": 0.01, "max": 100.0, "group": "simulated" },
      { "name": "Llr1_uH", "type": "float", "unit": "uH", "read_only": true, "min": 0.001, "max": 10.0, "group": "simulated" },
      { "name": "Llr2_uH", "type": "float", "unit": "uH", "read_only": true, "min": 0.001, "max": 10.0, "group": "simulated" },

      { "name": "Rtx_ohm", "type": "float", "unit": "ohm", "read_only": true, "min": 0.0001, "max": 10.0, "group": "simulated" },
      { "name": "Rrx1_ohm", "type": "float", "unit": "ohm", "read_only": true, "min": 0.0001, "max": 5.0, "group": "simulated" },
      { "name": "Rrx2_ohm", "type": "float", "unit": "ohm", "read_only": true, "min": 0.0001, "max": 5.0, "group": "simulated" },

      { "name": "input_voltage_V", "type": "float", "unit": "V", "read_only": true, "min": 0.0, "max": 1000.0, "group": "derived" },
      { "name": "output_voltage_V", "type": "float", "unit": "V", "read_only": true, "min": 0.0, "max": 1000.0, "group": "derived" },
      { "name": "input_power_W", "type": "float", "unit": "W", "read_only": true, "min": 0.0, "max": 10000.0, "group": "derived" },
      { "name": "output_power_W", "type": "float", "unit": "W", "read_only": true, "min": 0.0, "max": 10000.0, "group": "derived" },
      { "name": "efficiency_ratio", "type": "float", "unit": "ratio", "read_only": true, "min": 0.0, "max": 1.0, "group": "derived" },

      { "name": "copperloss_Tx_W", "type": "float", "unit": "W", "read_only": true, "min": 0.0, "max": 1000.0, "group": "simulated" },
      { "name": "copperloss_Rx1_W", "type": "float", "unit": "W", "read_only": true, "min": 0.0, "max": 500.0, "group": "simulated" },
      { "name": "copperloss_Rx2_W", "type": "float", "unit": "W", "read_only": true, "min": 0.0, "max": 500.0, "group": "simulated" },

      { "name": "m_copperloss_Tx_W", "type": "float", "unit": "W", "read_only": true, "min": 0.0, "max": 1000.0, "group": "simulated" },
      { "name": "m_copperloss_Rx1_W", "type": "float", "unit": "W", "read_only": true, "min": 0.0, "max": 500.0, "group": "simulated" },
      { "name": "m_copperloss_Rx2_W", "type": "float", "unit": "W", "read_only": true, "min": 0.0, "max": 500.0, "group": "simulated" },
      
      { "name": "coreloss_W", "type": "float", "unit": "W", "read_only": true, "min": 0.0, "max": 2000.0, "group": "simulated" },
      { "name": "totalloss_W", "type": "float", "unit": "W", "read_only": true, "min": 0.0, "max": 5000.0, "group": "derived" },

      { "name": "B_core_T", "type": "float", "unit": "T", "read_only": true, "min": 0.0, "max": 2.0, "group": "simulated" },
      { "name": "Bmean_left_T", "type": "float", "unit": "T", "read_only": true, "min": 0.0, "max": 2.0, "group": "simulated" },
      { "name": "Bmean_right_T", "type": "float", "unit": "T", "read_only": true, "min": 0.0, "max": 2.0, "group": "simulated" },
      { "name": "Bmean_center_T", "type": "float", "unit": "T", "read_only": true, "min": 0.0, "max": 2.0, "group": "simulated" },
      { "name": "Bmean_top_left_T", "type": "float", "unit": "T", "read_only": true, "min": 0.0, "max": 2.0, "group": "simulated" },
      { "name": "Bmean_bottom_left_T", "type": "float", "unit": "T", "read_only": true, "min": 0.0, "max": 2.0, "group": "simulated" },
      { "name": "Bmean_top_right_T", "type": "float", "unit": "T", "read_only": true, "min": 0.0, "max": 2.0, "group": "simulated" },
      { "name": "Bmean_bottom_right_T", "type": "float", "unit": "T", "read_only": true, "min": 0.0, "max": 2.0, "group": "simulated" },

      { "name": "Bmax_all_T", "type": "float", "unit": "T", "read_only": true, "min": 0.0, "max": 6.0, "group": "simulated" },

      { "name": "max_temperature_Cel", "type": "float", "unit": "C", "read_only": true, "min": 0.0, "max": 200.0, "group": "simulated" }
    ],

    "feature_order": {
      "inputs": [
        "w1_mm","l1_leg_mm","l1_top_mm","l2_mm","h1_mm","l1_center_mm",
        "Tx_turns","Tx_width_mm","Tx_height_mm","Tx_space_x_mm","Tx_space_y_mm","Tx_preg_mm",
        "Tx_layer_space_x_mm","Tx_layer_space_y_mm",
        "Rx_turns","Rx_width_mm","Rx_height_mm","Rx_space_x_mm","Rx_space_y_mm","Rx_preg_mm",
        "Rx_layer_space_x_mm","Rx_layer_space_y_mm",
        "g1_mm","g2_mm",
        "core_x_mm","core_y_mm","core_z_mm","core_volume_mm3","core_area_mm2","core_thickness_mm",
        "total_x_mm","total_y_mm","total_z_mm","total_volume_mm3","total_area_mm2","total_thickness_mm",
        "Operating_Current_in_A","Magnetizing_Current_in_A","freq_kHz","has_pan_bool","pan_blow_mps"
      ],
      "outputs": [
        "Ltx_uH","Lrx1_uH","Lrx2_uH","M1_ratio","M2_ratio","k1_ratio","k2_ratio",
        "Lmt_uH","Lmr1_uH","Lmr2_uH","Llt_uH","Llr1_uH","Llr2_uH",
        "Rtx_ohm","Rrx1_ohm","Rrx2_ohm",
        "input_voltage_V","output_voltage_V","input_power_W","output_power_W","efficiency_ratio",
        "copperloss_Tx_W","copperloss_Rx1_W","copperloss_Rx2_W","coreloss_W",
        "B_core_T","Bmean_left_T","Bmean_right_T",
        "Bmean_center_T","Bmean_top_left_T","Bmean_bottom_left_T",
        "Bmean_top_right_T","Bmean_bottom_right_T","Bmax_all_T",
        "m_copperloss_Tx_W","m_copperloss_Rx1_W","m_copperloss_Rx2_W",
        "totalloss_W","max_temperature_Cel"
      ]
    }
  },

  "model_inference": {
    "backend": "ann",
    "artifacts": {
      "regressor_pkl": "${paths.artifacts.model_pkl}",
      "preprocess_py": "${paths.artifacts.preprocess_py}"
    },
    "batch_size": 1024,
    "predict_entrypoint": {
      "script": "${paths.artifacts.predict_py}",
      "call": "predict",
      "args": ["--model", "${paths.artifacts.model_pkl}"]
    }
  },

  "simulation": {
    "enabled": true,
    "script": "${paths.artifacts.simulate_py}",
    "call": "run_simulation",
    "runner": "python_pyaedt"
  },

  "optimization": {
    "enabled": true,
    "runner": "python_nsga2",
    "script": "${paths.artifacts.optimize_py}",
    "nsga2": {
      "population": 128,
      "generations": 80,
      "seed": 42,
      "crossover": { "name": "sbx", "eta": 15.0, "prob": 0.9 },
      "mutation": { "name": "pm", "eta": 20.0, "prob": "1/n" },
      "repair": "rounding"
    },
    "objectives": [
      { "name": "volume_mm3", "goal": "minimize" },
      { "name": "totalloss_W", "goal": "minimize" }
    ],
    "constraints": [
      { "name": "max_temperature_Cel", "op": "<=", "value": 120.0 },
      { "name": "Bmax_all_T", "op": "<=", "value": 1.8 }
    ],
    "constraint_strs": [
      "2*Tx_height_mm + Tx_preg_mm + 2*Rx_height_mm + 2*Rx_preg_mm < h1_mm",
      "(Tx_layer_space_y_mm + Tx_width_mm)*ceiling(Tx_turns) + Tx_space_y_mm - Tx_layer_space_y_mm < l2_mm",
      "(Rx_width_mm + Rx_space_y_mm) < l2_mm",
      "g2_mm < h1_mm",
      "has_pan_bool*pan_blow_mps - pan_blow_mps == 0"
    ]
  },

  "ui": {
    "groups": [
      { "id": "geometry", "label": "형상 파라미터", "layout": "grid-2" },
      { "id": "geom_derived", "label": "형상 파생(입력 취급)", "layout": "grid-2" },
      { "id": "operating", "label": "운전 조건", "layout": "grid-2" },
      { "id": "cooling", "label": "냉각 조건", "layout": "grid-2" }
    ],
    "controls": {
      "float": { "widget": "slider+field", "precision": 4 },
      "int": { "widget": "stepper+field" },
      "bool": { "widget": "switch" }
    },
    "picker_hint": "프로젝트 리스트는 ${install_dir}/Projects/*/*.json 자동 스캔"
  }
}
